<!doctype html>
<html>
  <head>
    <title>Test Session Main Page</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  </head>

  <script type="text/javascript">
    $(window).ready(function() {
      let vars = {};
      console.log(window.location.href);
      window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
        vars[key] = value;
      });
      if (vars.hasOwnProperty("session")) {
        let sessionId = vars["session"];
        let parts = sessionId.split(',');
        let ids = [];
        parts.forEach(function(element) {
          ids.push(parseInt(element, 10));
        });

        localStorage.setItem("sessionId", JSON.stringify(ids));
        console.log("Session ID from url: " + sessionId +
          ", and saved to local storage: " + window.localStorage.getItem(
            "sessionId", ids));
      }

      // Inform the server that the session ID has been saved and can redirect
      // to the main session page.
      let socket = io();
      socket.on('connect', function () {
        console.log("SessionId Client connected");
        socket.emit('from', {
          page: 'sessionId'
        });
      });
      socket.on('redirect', function(destination) {
        window.location.href = destination;
      });
    });
  </script>

</html>
